{"version":3,"sources":["common/socket/index.js","common/socket/types.js","pages/customer/videos/video-view.js"],"names":["console","log","process","SocketServerURL","socket","io","auth","authToken","getAccessToken","on","err","message","open","POPUP_DESTROY","VideoView","match","history","addToastAction","_timer","user","videoId","params","id","useState","video","setVideo","watchId","setWatchId","popupHistoryId","setPopupHistoryId","playerProgree","setPlayerProgree","currentTime","setCurrentTime","videoDuration","setVideoDuration","isShowConfirmMessage","setIsShowConfirmMessage","playingVideo","setPlayingVideo","videoPlayerRef","useRef","reportResult","clicked","emit","useEffect","VideoApis","getVideo","then","res","success","data","e","error","ToastStatus","Danger","close","setInterval","current","duration","getDuration","currentSeconds","getCurrentTime","percent","secsToHMS","clearInterval","videoUrl","ServerURL","src","Container","Row","Col","Button","variant","onClick","goBack","className","title","style","position","paddingTop","url","top","left","playing","width","height","config","file","attributes","controlsList","onContextMenu","preventDefault","ref","onPause","a","b","onEnded","onStart","newPopupHistoryId","Date","fontSize","transform","size","icon","faPause","faPlay","ProgressBar","animated","now","label","right","zIndex","Toast","show","flexBasis","animation","autohide","delay","onClose","Header","Body","Promise","all","defaultProps","withRouter","connectToasts","connectAuth"],"mappings":"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","file":"static/js/17.629379ff.chunk.js","sourcesContent":["import { io } from \"socket.io-client\";\r\nimport { SocketServerURL } from '../constants/default-values';\r\nimport { getAccessToken }  from '../utils/auth';\r\n\r\nconsole.log(\"process.env.NODE_ENV\", process.env.NODE_ENV);\r\nconsole.log(\"SocketServerURL\", SocketServerURL);\r\n\r\nif(!process.env.NODE_ENV) {\r\n  localStorage.debug = '*';\r\n}\r\n\r\nconst socket = io(SocketServerURL, {\r\n  auth: {\r\n    authToken: getAccessToken()\r\n  }\r\n});\r\n\r\n// socket.io.open(error => {\r\n//   if (error) {\r\n//     console.log(error);\r\n//   }\r\n//   console.log(\"socket server connected\");\r\n// })\r\n\r\nsocket.on(\"connect_error\", (err) => {\r\n  console.log(`connect_error due to ${err.message}`);\r\n  console.log(`trying again`);\r\n  socket.open();\r\n});\r\n\r\nexport default socket;\r\n","export const VIDEO_START_PLAYING = \"VIDEO_START_PLAYING\"\r\nexport const VIDEO_END_VIDEO = \"VIDEO_END_VIDEO\"\r\n\r\nexport const POPUP_DESTROY = \"POPUP_DESTROY\"\r\nexport const POPUP_PUSH = \"POPUP_PUSH\"\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { withRouter } from 'react-router';\r\nimport { Button, Container, Row, Col, Toast, ProgressBar } from 'react-bootstrap';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport { faPlay, faPause } from '@fortawesome/free-solid-svg-icons';\r\nimport PropTypes from 'prop-types';\r\nimport ReactPlayer from 'react-player';\r\n\r\nimport { connectToasts, connectAuth } from '../../../common/redux/connects';\r\nimport { ToastStatus } from '../../../common/enums/toast';\r\nimport { secsToHMS } from '../../../common/utils/common';\r\n\r\nimport VideoApis from '../../../common/api/videos';\r\nimport { ServerURL } from '../../../common/constants/default-values';\r\nimport socket from '../../../common/socket';\r\nimport { POPUP_DESTROY, VIDEO_START_PLAYING, VIDEO_END_VIDEO, POPUP_PUSH } from '../../../common/socket/types';\r\n\r\nfunction VideoView ({match, history, addToastAction, user}) {\r\n    let _timer = null;\r\n    const videoId = match.params.id\r\n    const [video, setVideo] = useState(null)\r\n    const [watchId, setWatchId] = useState(0)\r\n    const [popupHistoryId, setPopupHistoryId] = useState(0)\r\n    const [playerProgree, setPlayerProgree] = useState(0)\r\n    const [currentTime, setCurrentTime] = useState(0)\r\n    const [videoDuration, setVideoDuration] = useState(0)\r\n    const [isShowConfirmMessage, setIsShowConfirmMessage] = useState(false)\r\n    const [playingVideo, setPlayingVideo] = useState(false)\r\n    const videoPlayerRef = useRef(null)\r\n\r\n    const refreshPage = () => {\r\n        VideoApis\r\n            .getVideo({id: videoId})\r\n            .then(res => {\r\n                if(res.success) {\r\n                    setVideo(res.data)\r\n                }\r\n            }, e =>  addToastAction(\"Loading Video\", e.error, ToastStatus.Danger) )\r\n    }\r\n\r\n    const onStartVideo = () => {\r\n        console.log(\"playing video....\");\r\n        socket.emit(VIDEO_START_PLAYING, videoId)\r\n\r\n        socket.on(POPUP_PUSH, (watchId , newPopupHistoryId) => {\r\n            if(newPopupHistoryId != popupHistoryId && playingVideo) {\r\n                setWatchId(watchId);\r\n                setPopupHistoryId(newPopupHistoryId);\r\n                setIsShowConfirmMessage(true);\r\n                console.log(\"popupHistoryIdx\", new Date(), watchId, newPopupHistoryId); // world\r\n            }\r\n        });\r\n    }\r\n\r\n    const onPauseVideo = () => {\r\n        addToastAction(\"Alert\", \"Dont try to pause Video\", ToastStatus.Danger)\r\n        setPlayingVideo(true)\r\n    }\r\n\r\n    const onEndedVideo = () => {\r\n        // report finish\r\n        console.log(\"onEndedVideo\");\r\n        setPlayingVideo(false)\r\n        socket.emit(VIDEO_END_VIDEO, watchId)\r\n    }\r\n\r\n    const reportResult = (clicked = false) => {\r\n        console.log(\"reportResult\");\r\n\r\n        if(watchId && popupHistoryId && playingVideo) {\r\n            socket.emit(POPUP_DESTROY, watchId, popupHistoryId, clicked)\r\n            setPopupHistoryId(0);\r\n        } else {\r\n            console.log(\"watchId or popupHistoryId is null\")\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        refreshPage();\r\n        socket.open()\r\n\r\n        return () => {\r\n            socket.close();\r\n            setIsShowConfirmMessage(false)\r\n        }\r\n    }, [ videoId ])\r\n\r\n    useEffect(() => {\r\n        _timer = setInterval(() => {\r\n            if(videoPlayerRef.current) {\r\n                const duration = videoPlayerRef.current.getDuration();\r\n                const currentSeconds = videoPlayerRef.current.getCurrentTime();\r\n                let percent = (currentSeconds / duration) * 100;\r\n\r\n                setCurrentTime(secsToHMS(currentSeconds))\r\n                setVideoDuration(secsToHMS(duration))\r\n                setPlayerProgree(percent)\r\n            }\r\n        }, 500);\r\n\r\n        return () => {\r\n            if(_timer) {\r\n                clearInterval(_timer)\r\n            }\r\n        }\r\n    }, [videoPlayerRef])\r\n\r\n    if(!video) {\r\n        return null\r\n    }\r\n\r\n    const videoUrl = `${ServerURL}/${video.src}`;\r\n\r\n    return (\r\n        <Container>\r\n            <Row>\r\n                <Col>\r\n                    <Button variant='link' onClick={() => history.goBack()}>\r\n                        <span className='h6'>Back</span>\r\n                    </Button>\r\n                </Col>\r\n            </Row>\r\n            <div className='text-center'>\r\n                <p>{video.title}</p>\r\n            </div>\r\n            <div style={{\r\n                    position: 'relative',\r\n                    paddingTop: '56.25%' \r\n                }}\r\n                className=\"player-wrapper\"\r\n            >\r\n                <ReactPlayer\r\n                    className='react-player'\r\n                    url={videoUrl}\r\n                    style={{\r\n                        position: 'absolute',\r\n                        top: 0,\r\n                        left: 0\r\n                    }}\r\n                    playing={playingVideo}\r\n                    width='100%'\r\n                    height='100%'\r\n                    // controls\r\n                    config={{ file: { \r\n                        attributes: { \r\n                            controlsList: 'nodownload'},\r\n                        },\r\n                        onContextMenu: e => e.preventDefault(),\r\n                    }}\r\n                    ref={videoPlayerRef}\r\n                    onPause={(a, b) => onPauseVideo()}\r\n                    onEnded={() => onEndedVideo()}\r\n                    onStart={() => onStartVideo()}\r\n                />\r\n                <div className={`video-player-controllers text-center pt-2 ${playingVideo && 'd-none'}`}\r\n                    style={{\r\n                        position: 'absolute',\r\n                        left: '50%',\r\n                        top: '50%',\r\n                        fontSize: 50,\r\n                        transform: 'translateX(-50%) translateY(-50%)'\r\n                    }}\r\n                >\r\n                    <FontAwesomeIcon className='cursor-pointer text-info ml-2' size='lg' icon={playingVideo ? faPause : faPlay }  onClick={() => setPlayingVideo(!playingVideo)}/>\r\n                </div>\r\n            </div>\r\n            <div>\r\n                <div className=\"text-right color-grey\">{videoDuration}</div>\r\n                <ProgressBar className=\"mt-1\" animated  variant=\"info\" now={playerProgree} label={`${currentTime} s`} />\r\n            </div>\r\n            \r\n            <div style={{ width: 300, position: 'fixed', right: 5, top: 60, zIndex: 9999 }}\r\n                className='d-flex flex-column align-items-end'\r\n            >\r\n                <Toast \r\n                    show={isShowConfirmMessage}\r\n                    key={1}\r\n                    className='w-100' \r\n                    style={{ flexBasis: 'unset' }} \r\n                    animation\r\n                    autohide\r\n                    delay={5000}\r\n                    onClose={() => {\r\n                        reportResult()\r\n                        setIsShowConfirmMessage(false)\r\n                    }}\r\n                >\r\n                    <Toast.Header className={'bg-info'}>\r\n                        <strong className=\"text-white mr-auto\">Alert</strong>\r\n                    </Toast.Header>\r\n                    <Toast.Body className=\"text-center\">\r\n                        <div className=\"mb-3\">\r\n                            Click the here if you are seeing this video\r\n                        </div>\r\n                        <Button variant=\"info\"\r\n                            onClick={() => {\r\n                                Promise.all([\r\n                                    setIsShowConfirmMessage(false),\r\n                                    reportResult(true)\r\n                                ])\r\n                            }}\r\n                        >Cofirm</Button>{' '}\r\n                    </Toast.Body>\r\n                </Toast>\r\n            </div>\r\n        </Container>\r\n    )\r\n}\r\n\r\nVideoView.propTypes = {\r\n    id: PropTypes.number\r\n};\r\n\r\nVideoView.defaultProps = {\r\n    id: 0\r\n};\r\n\r\nexport default withRouter(connectToasts(connectAuth(VideoView)));\r\n"],"sourceRoot":""}